#Задание 1. Используем только пакет dplyr.
#Базовые операции
#Выберите столбцы mpg и hp из набора данных mtcars
#Выберите все столбцы, кроме vs и am
#Отфильтруйте машины с mpg больше 20
#Отфильтруйте машины с 6 цилиндрами и мощностью (hp) больше 100
#Сортировка и преобразование
#Отсортируйте данные по возрастанию расхода топлива (mpg)
#Отсортируйте сначала по количеству цилиндров (cyl), затем по убыванию мощности (hp)
#Создайте новый столбец km_per_liter (перевод миль на галлон в км на литр)
#Создайте столбец power_to_weight (отношение мощности к весу)
#Агрегация данных
#Посчитайте средний расход топлива (mpg) для машин с автоматической и ручной коробкой передач
#Найдите максимальную мощность (hp) в каждой группе по количеству цилиндров
#Посчитайте количество машин каждого типа коробки передач (am)
#Для каждого количества цилиндров найдите машину с самым высоким соотношением мощности к весу
#Группировка данных
#Сгруппируйте данные по количеству цилиндров и посчитайте средний вес (wt)
#Сгруппируйте по типу коробки передач и найдите минимальный и максимальный расход топлива
#Для каждой комбинации цилиндров и коробки передач посчитайте медианную мощность
#Комбинированные операции
#Для машин с 6+ цилиндрами выберите только столбцы mpg, hp, wt и отсортируйте по расходу
#Создайте столбец с флагом "эффективности" (mpg > 20), затем отфильтруйте только эффективные машины
#Для машин весом менее 3.5 тонн посчитайте среднюю мощность по группам цилиндров
#Найдите 4-цилиндровую машину с самым высоким соотношением мощности к весу
#Работа с текстовыми данными
#В данных starwars выберите только персонажей с синим цветом глаз
#Отфильтруйте персонажей, чей рост больше 180 см, и отсортируйте по массе
#Посчитайте средний рост персонажей по полу (gender)
#Найдите самый распространенный цвет глаз среди персонажей
#Дополнительные задания
#Используя group_by и mutate, добавьте столбец с ранжированием машин по мощности внутри каждой группы цилиндров
#Создайте сводную таблицу с количеством машин по комбинациям цилиндров и коробок передач
#Примените несколько агрегатных функций (min, max, mean) к разным столбцам в одной операции
#Объедините операции filter, select, arrange и mutate в одном пайплайне

library(dplyr)
data(mtcars)
data(starwars)

# Выберите столбцы mpg и hp из набора данных mtcars
mtcars %>% select(mpg, hp)

# Выберите все столбцы, кроме vs и am
mtcars %>% select(-vs, -am)

# Отфильтруйте машины с mpg больше 20
mtcars %>% filter(mpg > 20)

# Отфильтруйте машины с 6 цилиндрами и мощностью (hp) больше 100
mtcars %>% filter(cyl == 6, hp > 100)

# Отсортируйте данные по возрастанию расхода топлива (mpg)
mtcars %>% arrange(mpg)

# Отсортируйте сначала по количеству цилиндров (cyl), затем по убыванию мощности (hp)
mtcars %>% arrange(cyl, desc(hp))

# Создайте новый столбец km_per_liter (перевод миль на галлон в км на литр)
mtcars %>% mutate(km_per_liter = mpg * 0.425)

# Создайте столбец power_to_weight (отношение мощности к весу)
mtcars %>% mutate(power_to_weight = hp / wt)

# Посчитайте средний расход топлива (mpg) для машин с автоматической и ручной коробкой передач
mtcars %>% group_by(am) %>% summarise(mean_mpg = mean(mpg))

# Найдите максимальную мощность (hp) в каждой группе по количеству цилиндров
mtcars %>% group_by(cyl) %>% summarise(max_hp = max(hp))

# Посчитайте количество машин каждого типа коробки передач (am)
mtcars %>% group_by(am) %>% summarise(count = n())

# Для каждого количества цилиндров найдите машину с самым высоким соотношением мощности к весу
mtcars %>%
  mutate(power_to_weight = hp / wt) %>%
  group_by(cyl) %>%
  slice_max(power_to_weight, n = 1) %>%
  ungroup() %>%
  mutate(car_model = rownames(.)) %>%
  select(car_model, everything())

# Сгруппируйте данные по количеству цилиндров и посчитайте средний вес (wt)
mtcars %>% group_by(cyl) %>% summarise(mean_wt = mean(wt))

# Сгруппируйте по типу коробки передач и найдите минимальный и максимальный расход топлива
mtcars %>% group_by(am) %>% summarise(min_mpg = min(mpg), max_mpg = max(mpg))

# Для каждой комбинации цилиндров и коробки передач посчитайте медианную мощность
mtcars %>% group_by(cyl, am) %>% summarise(median_hp = median(hp))

# Для машин с 6+ цилиндрами выберите только столбцы mpg, hp, wt и отсортируйте по расходу
mtcars %>%
  filter(cyl >= 6) %>%
  select(mpg, hp, wt) %>%
  arrange(desc(mpg))

# Создайте столбец с флагом "эффективности" (mpg > 20), затем отфильтруйте только эффективные машины
mtcars %>%
  mutate(efficient = mpg > 20) %>%
  filter(efficient)

# Для машин весом менее 3.5 тонн посчитайте среднюю мощность по группам цилиндров
mtcars %>%
  filter(wt < 3.5) %>%
  group_by(cyl) %>%
  summarise(mean_hp = mean(hp))

# Найдите 4-цилиндровую машину с самым высоким соотношением мощности к весу
mtcars %>%
  filter(cyl == 4) %>%
  mutate(power_to_weight = hp / wt) %>%
  slice_max(power_to_weight, n = 1) %>%
  ungroup() %>%
  mutate(car_model = rownames(.)) %>%
  select(car_model, everything())
# В данных starwars выберите только персонажей с синим цветом глаз
starwars %>% filter(eye_color == "blue")

# Отфильтруйте персонажей, чей рост больше 180 см, и отсортируйте по массе
starwars %>% filter(height > 180) %>% arrange(desc(mass))

# Посчитайте средний рост персонажей по полу (gender)
starwars %>% group_by(gender) %>% summarise(mean_height = mean(height, na.rm = TRUE))

# Найдите самый распространенный цвет глаз среди персонажей
starwars %>% count(eye_color, sort = TRUE) %>% slice_head(n = 1)

# Используя group_by и mutate, добавьте столбец с ранжированием машин по мощности внутри каждой группы цилиндров
mtcars %>%
  group_by(cyl) %>%
  mutate(rank_hp = rank(desc(hp)))

# Создайте сводную таблицу с количеством машин по комбинациям цилиндров и коробок передач
mtcars %>%
  group_by(cyl, am) %>%
  summarise(count = n())

# Примените несколько агрегатных функций (min, max, mean) к разным столбцам в одной операции
mtcars %>%
  summarise(
    min_mpg = min(mpg),
    max_hp = max(hp),
    mean_wt = mean(wt)
  )

# Объедините операции filter, select, arrange и mutate в одном пайплайне
mtcars %>%
  filter(cyl == 6) %>%
  select(mpg, hp, wt) %>%
  mutate(power_to_weight = hp / wt) %>%
  arrange(desc(power_to_weight))
